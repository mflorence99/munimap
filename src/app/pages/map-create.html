<app-ol-map #theMap [path]="path">
  <ng-container *ngIf="theMap.initialized">
    <app-ol-control-attribution></app-ol-control-attribution>
    <app-ol-control-zoom></app-ol-control-zoom>
    <app-ol-control-zoom2extent></app-ol-control-zoom2extent>

    <!-- BG LAYER -->

    <app-ol-layer-tile>
      <app-ol-source-osm></app-ol-source-osm>
      <app-ol-filter-pencil></app-ol-filter-pencil>
    </app-ol-layer-tile>

    <app-ol-layer-mapbox styleUrl="mapbox://styles/mapbox/bright-v9">
      <app-ol-filter-crop2boundary></app-ol-filter-crop2boundary>
    </app-ol-layer-mapbox>

    <!-- HILLSHADE LAYER -->

    <app-ol-layer-tile [maxZoom]="17.5" [opacity]="0.5">
      <app-ol-source-xyz
        [url]="'https://server.arcgisonline.com/ArcGIS/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}'"
      >
        <app-ol-attribution>Powered by Esri</app-ol-attribution>
      </app-ol-source-xyz>
      <app-ol-filter-crop2boundary></app-ol-filter-crop2boundary>
    </app-ol-layer-tile>

    <!-- SELECTABLES LAYER -->

    <app-ol-layer-vector *ngIf="!atTownLevel(path)">
      <app-ol-style-features></app-ol-style-features>
      <app-ol-source-geojson [layerKey]="'selectables'"></app-ol-source-geojson>

      <app-ol-interaction-select [eventType]="'pointermove'">
      </app-ol-interaction-select>

      <app-ol-interaction-select
        (select)="onSelectFeature($event)"
        [eventType]="'click'"
      >
      </app-ol-interaction-select>
    </app-ol-layer-vector>

    <!-- BOUNDARY LAYER -->

    <app-ol-layer-vector *ngIf="atTownLevel(path)">
      <app-ol-style-features></app-ol-style-features>
      <app-ol-source-boundary></app-ol-source-boundary>
    </app-ol-layer-vector>
  </ng-container>
</app-ol-map>

<app-map-filter
  (pathChanged)="onPathChanged($event)"
  (pathSelected)="onPathSelected($event)"
  [path]="path"
  class="filter"
>
</app-map-filter>
